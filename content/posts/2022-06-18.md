+++
title = 2022-06-18
publishDate = 2022-06-18
tags = ["deno-backend"]
categories = ["notes"]
draft = false
+++

-   deno_backend service dependencies
-   functions connecting to postgres in deno

<!--more-->


## deno_backend service dependencies {#deno-backend-service-dependencies}

deno on docker install dependencies each time it's run.
Maybe deps.ts file will solve the problem.


## functions connecting to postgres in deno {#functions-connecting-to-postgres-in-deno}

const connect: (client: Client) =&gt; TE.TaskEither&lt;string, Client&gt; =
    client =&gt; pipe(
	TE.tryCatch(
	    () =&gt; client.connect(),
	    reason =&gt; reason as string),
	TE.map(
	    () =&gt; client
	)

)

const queryArray: (sql: string) =&gt; (client: Client) =&gt; TE.TaskEither&lt;string, Array&lt;string&gt;&gt; =
    sql =&gt; client =&gt; {
	return pipe(
	    client,
	    client =&gt; TE.tryCatch(
		() =&gt; client.queryArray(sql),
		reason =&gt; reason as string
	    ),
	    TE.map(x =&gt; x.rows),
	    TE.map(x =&gt; {
		return [\`${x}\`]
	    })
	)
    }

const getUserPg: (user: string) =&gt; TE.TaskEither&lt;string, User&gt; =
    user =&gt; {
	return pipe(
	  new Client({
	      user: "pguser",
	      database: "pgdb",
	      hostname: "postgresdb",
	      password: "pgpass",
	      port: 5432
	  }),
	    connect,
	    TE.chain(queryArray('SELECT \* FROM "Users";')),
	    TE.map(x =&gt; {
		return  {name: \`${x}\`}
	    })

    )
}